<div class="add-todo-container">
  <h3 class="add-todo-title" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTodoForm" aria-expanded="false" aria-controls="collapseTodoForm">
    Add a todo
  </h3>
  <button class="add-todo-btn" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTodoForm" aria-expanded="false" aria-controls="collapseTodoForm">
    <i class="fas fa-plus"></i>
  </button>
</div>


<div class="collapse" id="collapseTodoForm">
  <div class="card card-body" id="add-todo-form">
    <%= simple_form_for Todo.new, remote: true do |f| %>
       <%= f.input :title %>
       <%= f.input :deadline, as: :string, required: true, input_html: {class: "datepicker"} %>
       <ul class="error-messages"></ul>
       <%= f.submit "Ajouter", class: "btn btn-primary" %>
    <% end %>
  </div>
</div>

<ul id='list' data-controller='drag'>
  <% @todos.each do |todo| %>
    <li class="list-item" data-id="<%= todo.id %>" id="todo-<%= todo.id %>">

      <div class="d-flex list-item-header">
        <div class="position-circle flexbox-center">
          <div class='position'><%= todo.position %></div>
        </div>
        <p class="todo-title <%= 'todo-title-checked' if todo.done %> my-auto" id="todo-title-<%= todo.id %>"><%= todo.title.capitalize %></p>

        <div class="d-flex checkbox-container">
          <div class="checkbox flexbox-center <%= 'checked' if todo.done %>" data-todo-id='<%= todo.id %>'>
            <i class="fas fa-check <%= 'fa-check-checked' if todo.done %> fa-check-<%= todo.id %>"></i>
          </div>
          <div class='check-circle'></div>
        </div>

        <%= link_to todo_path(todo), method: :delete, data: { confirm: "Are you sure?" }, class: 'delete-todo',remote: true do %>
          <i class="far fa-minus-square"></i>
        <% end %>
      </div>

      <div class="d-flex my-2">
        <p class="my-auto">Deadline</p>
        <div class="date-container">
          <input class="changeDate px-0" data-id='<%= todo.id %>' value="<%= todo.deadline %>"/>
          <div class="underline"></div>
        </div>
      </div>


      <button class="comment-btn" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= todo.id %>" aria-expanded="false" aria-controls="collapse<%= todo.id %>">
        <i class="far fa-comment-dots"></i>
      </button>

      <div class="collapse" id="collapse<%= todo.id %>">
        <div class="card card-body add-comment-form">

          <ul id='todo-<%= todo.id %>-comments'>
            <% todo.comments.each do |comment| %>
              <li id='comment-<%= comment.id %>'>
                <i class="far fa-comment-dots"></i>
                <%= comment.content %>
                <%= link_to 'delete', comment_path(comment), method: :delete, remote: true %>
              </li>
            <% end %>
          </ul>

          <%= simple_form_for [ todo, Comment.new ], remote: true, html: {id: "new_comment-#{todo.id}"} do |f| %>
            <%= f.input :content, input_html: {id: "comment_content-#{todo.id}"} %>
            <%= f.submit "Submit comment", class: "btn btn-primary" %>
          <% end %>

        </div>
      </div>

    </li>
  <% end %>
</ul>

